<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>검색결과</title>
  <meta name="_csrf" th:content="${_csrf.token}">
  <meta name="_csrf_header" th:content="${_csrf.headerName}">
  <link href="/webjars/bootstrap/5.3.3/css/bootstrap.min.css" rel="stylesheet">
  <script src="/webjars/bootstrap/5.3.3/js/bootstrap.bundle.min.js"></script>
  <script src="/js/jquery-3.7.1.js"></script>
  <link href="/css/user/home.css" rel="stylesheet">
  <link href="/css/user/searchBox.css" rel="stylesheet">
  <link href="/css/user/searchResult.css" rel="stylesheet">

  <script th:inline="javascript">
    $(function () {
      $("#logo").click(function () {
        location.href = "/";
      });

      $("#cart").click(function () {
        location.href = "/cart";
      });

      $("#myPage").click(function () {
        location.href = "/myPage";
      });
    });
  </script>
</head>
<body>
<div th:replace="~{fragment/header :: header}"></div>
<script th:src="@{/js/search/search_filter.js}"></script>
<main class="container_wrapper">
  <input type="hidden" id="keywordHidden" th:value="${keyword}">
  <section id="contents" class="contents_wrap">
    <div class="contents_inner">
      <div class="search_result_top">
        <div class="title_wrap title_size_lg">
          <h1 class="title_heading">
            <span style="color:#1e5f1e">
              '
              <span class="search_value" th:text="${keyword}"></span>
              '
            </span>
            <th:block th:if="${totalCount > 0 }">
              <span th:text="'에 대한 ' + ${totalCount} + '개의 검색 결과'"></span>
            </th:block>
            <th:block th:if="${totalCount == 0 || totalCount == null}">
              <span th:text="'상품 검색 결과가 없습니다.'"></span>
            </th:block>
          </h1>
        </div>
        <div class="search_result_wrap" th:if="${#lists.isEmpty(searchResults)}">
          <p>검색 결과가 없습니다.</p>
        </div>
        <div class="search_result_wrap" th:if="${!#lists.isEmpty(searchResults)}">
          <!-- 필터 영역 -->
          <div class="filter_area">
            <p> 필터 추가 예정 </p>
          </div>
          <!-- 결과 영역 -->
          <div class="container w-75 mt-5">
            <div class="d-flex justify-content-end align-items-center mb-3">
              <!-- 장바구니, 찜 버튼 -->

              <!--    <div class="icon ms-auto mb-4">-->
              <!--      <img src="/img/user/heart.png" class="me-2" width="36" height="36" alt="찜">-->
              <!--      <img src="/img/user/cart.png" class="me-2" width="36" height="36" alt="장바구니">-->
              <!--    </div>-->

              <!-- 드롭다운 -->
              <div class="dropdown me-2">
                <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenu"
                        data-bs-toggle="dropdown" aria-expanded="false">
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenu">
                  <li><a class="dropdown-item" href="#" data-sort="sales">판매량순</a></li>
                  <li><a class="dropdown-item" href="#" data-sort="latest">최신순</a></li>
                  <li><a class="dropdown-item" href="#" data-sort="name">상품명순</a></li>
                  <li><a class="dropdown-item" href="#" data-sort="lowPrice">낮은가격순</a></li>
                  <li><a class="dropdown-item" href="#" data-sort="highPrice">높은가격순</a></li>
                </ul>
                <!-- 페이지당 보기 -->
                <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownView"
                        data-bs-toggle="dropdown" aria-expanded="false">
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownView">
                  <li><a class="dropdown-view" href="#" data-size="20">20개씩 보기</a></li>
                  <li><a class="dropdown-view" href="#" data-size="50">50개씩 보기</a></li>
                  <li><a class="dropdown-view" href="#" data-size="100">100개씩 보기</a></li>
                </ul>
              </div>
            </div>

            <div class="book-items mt-4">
              <ul class="prod_list" th:each="goods : ${searchResults}">
                <!-- goods 리스트를 반복하여 출력 -->
                <li class="prod_item d-flex justify-content-between align-items-start">
                  <div class="prod_area d-flex align-items-start mb-5">
                    <input type="checkbox" class="item-checkbox mt-1 ms-1"
                           style="width: 18px; height: 18px;">
                    <div class="book-item d-flex mt-1 ms-3">
                      <!-- 상품 이미지 클릭 시 상세 페이지 이동 -->
                      <div>

                      <a th:href="@{/goods/GoodsDetail/{no}(no=${goods.goodsNo})}"
                         class="show-detail">
                        <div class="img-box">
                          <img th:src="${goods.mainImage != null ? goods.mainImage.goodsUrl + '/' + goods.mainImage.goodsImageName
                                        : '/images/user/book/item1.png'}" style="width:200px; height:280px;"/>
                        </div>
                      </a>
                      </div>
                      <div class="item-info ms-3">

                        <div class="prod_name_group">
                          <!-- 상품 이름 클릭 시 상세 페이지 이동 -->
                          <a th:href="@{/goods/GoodsDetail/{no}(no=${goods.goodsNo})}"
                             class="show-detail">
                            <!-- TODO : 이름 옆에 카테고리 이름 추가하기 -->
                            <span class="item-name" th:text="${goods.goodsName}"></span>
                          </a>
                          <br>
                        </div>

                        <div class="prod_desc_info">
                          <span th:text="${goods.goodsContent}"></span>
                        </div>

                        <!-- TODO : 저자와 출판사 클릭시 해당 검색어로 검색하는 기능 추가하기 -->
                        <div class="prod_author_info">
                          <div class="prod_author_group">
                            <span class="item-author" th:text="${goods.goodsWriter}"></span>
                            <span class="type">저자(글)</span>
                          </div>

                          <div class="prod_publish">
                            <th:block th:if="${goods.companyName != null}">
                              <span class="prod_publish" th:text="${goods.companyName}"></span>
                            </th:block>
                            <th:block th:if="${goods.companyName == null}">
                              <span class="prod_publish">출판사 없음</span>
                            </th:block>
                            <span class="gap"> · </span>
                            <span class="date" th:text="${#temporals.format(goods.goodsCreateAt, 'yyyy년 MM월 dd일')}"></span>
                          </div>

                          <!-- TODO : 할인 기능 추가할 시 변경 필요 -->
                          <div class="prod_price">
                            <span class="val" th:text="${#numbers.formatInteger(goods.goodsPrice, 3, 'COMMA')}"></span>
                            <span class="unit">원&nbsp;</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="prod_btn_wrap d-flex flex-column align-items-end" style="flex-shrink: 0;">
                    <div class="icon ms-auto mb-4">
                      <!-- 찜 상태에 따른 하트 아이콘 -->
                      <img th:src="${goods.wishStatus == 'Y'} ? '/images/user/redHeart.png' : '/images/user/heart.png'"
                           class="heart me-2"
                           th:data-id="${goods.goodsNo}"
                           width="36"
                           height="36"
                           alt="찜">
                      <img src="/images/user/cart.png" class="cart me-2" th:data-id="${goods.goodsNo}"
                           width="36" height="36" alt="장바구니">
                    </div>
                    <!-- 바로구매 버튼 -->
                    <button class="btn btn-primary buy-now-btn" th:data-id="${goods.goodsNo}">바로구매
                    </button>
                  </div>
                </li>
              </ul>
              <hr>
              <!-- 페이지네이션 -->
              <nav th:if="${totalPages > 0}" aria-label="Page navigation example">
                <ul class="pagination justify-content-center">
                  <!-- 이전 페이지 버튼 -->
                  <li th:classappend="${currentPage == 1} ? 'disabled' : ''">
                    <a class="page-link" href="#" th:attr="data-page=${currentPage - 1}"
                       th:if="${currentPage > 1}">&lt;</a>
                  </li>

                  <!-- 페이지 번호 -->
                  <li th:each="i : ${#numbers.sequence(startPage, endPage)}"
                      th:classappend="${currentPage == i} ? 'active' : ''">
                    <a class="page-link" href="#" th:attr="data-page=${i}" th:text="${i}"></a>
                  </li>

                  <!-- 다음 페이지 버튼 -->
                  <li th:classappend="${currentPage == totalPages} ? 'disabled' : ''">
                    <a class="page-link" href="#" th:attr="data-page=${currentPage + 1}"
                       th:if="${currentPage < totalPages}">&gt;</a>
                  </li>
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</main>

</body>
</html>